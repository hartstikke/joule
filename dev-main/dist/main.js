(function(u){typeof define=="function"&&define.amd?define(u):u()})(function(){"use strict";const u={URL:"https://api.offr.be/partners/joule/calculate",KEY:"clomvufdi000408i8f7i0gu6t"},y={12:.4,24:.33,36:.16,48:.16};console.log("test");let d=document.querySelector('input[name="durationInMonths"]:checked').value;const h=605,l=1.21;class f{constructor(){this.initializeElements(),this.setupEventListeners(),this.originalButtonText=this.submitCalculator.textContent}initializeElements(){this.submitCalculator=document.getElementById("form-button"),this.bikeRetailPrice=document.getElementById("bikeRetailPrice"),this.calculatorResult=document.querySelector(".calculator_result"),this.calculatorDefault=document.querySelector(".calculator_default"),this.resultWrapper=document.getElementById("calculator_result-wrapper")}setLoadingState(e){e?(this.submitCalculator.textContent="Calculating...",this.submitCalculator.disabled=!0):(this.submitCalculator.textContent=this.originalButtonText,this.submitCalculator.disabled=!1)}setupEventListeners(){this.submitCalculator.addEventListener("click",this.handleSubmit.bind(this)),this.bikeRetailPrice.addEventListener("blur",this.validateBikePrice.bind(this)),this.initializeLinkedInputs(),this.setupRadioChangeListener()}initializeLinkedInputs(){document.querySelectorAll(".linked-input, .linked-range").forEach(t=>{t.addEventListener("input",this.updateLinkedValue),this.updateLinkedValue.call(t)}),document.addEventListener("input",this.handleLinkedInputs.bind(this))}updateLinkedValue(){if(this.dataset.linkedInput||this.dataset.linkedRange,this.classList.contains("linked-range")){const e=(this.value-this.min)/(this.max-this.min)*100;this.style.background=`linear-gradient(to right, #A0E8E3 0%, #A0E8E3 ${e}%, #F3F3F3 ${e}%, #F3F3F3 100%)`}}handleLinkedInputs(e){const{target:t}=e,s=t.dataset.linkedInput||t.dataset.linkedRange;s&&document.querySelectorAll(`[data-linked-input="${s}"], [data-linked-range="${s}"]`).forEach(i=>{i.value=t.value,this.updateLinkedValue.call(i)})}validateBikePrice(e){Number(e.currentTarget.value)<h&&setTimeout(()=>{e.currentTarget.value=h},50)}setupRadioChangeListener(){document.addEventListener("change",e=>{if(e.target.type==="radio"&&e.target.closest(".calculator_radio-block")){const t=e.target.name;document.querySelectorAll(`.calculator_radio-block input[type="radio"][name="${t}"]`).forEach(r=>r.closest(".calculator_radio-block").classList.remove("checked")),e.target.closest(".calculator_radio-block").classList.add("checked")}})}getFormData(){const e=document.querySelector("#statute-selector .w--tab-active"),t=document.querySelector('input[name="durationInMonths"]:checked');return{financingMethod:document.querySelector('input[name="financingMethod"]:checked').value,grossSalary:parseFloat(e.querySelector("#grossSalary").value),workingRegimePercent:1,civilStatus:document.querySelector('input[name="civilStatus"]:checked').value,workingSpouse:!0,dependentChildren:parseFloat(document.getElementById("dependentChildren").value),commuteKilometers:parseFloat(document.getElementById("commuteKilometers").value),commuteWeeklyFrequency:parseFloat(document.getElementById("commuteWeeklyFrequency").value),computeModel:e.querySelector(".radio--pc:checked").value,computeLeaseRateDto:{bikeRetailPrice:parseFloat(this.bikeRetailPrice.value)/l,accessoriesRetailPrice:parseFloat(document.getElementById("accessoriesRetailPrice").value)/l,discountRate:0,interestRate:.077,durationInMonths:parseFloat(t.value),insurancePremium:.035,deliveryCost:50,assemblyCost:117,residualValue:parseFloat(t.getAttribute("data-residualValue")),yearlyAdminFee1:36,yearlyAdminFee2:18.33,yearlyMaintenanceFee:parseFloat(document.querySelector('input[name="yearlyMaintenanceFee"]:checked').value)/l}}}async fetchCalculation(e){try{return await(await fetch(u.URL,{method:"POST",headers:{"Content-Type":"application/json","x-offr-api-key":u.KEY},body:JSON.stringify(e)})).json()}catch(t){throw console.error("Calculation error:",t),new Error(`Failed to calculate: ${t.message}`)}}setValue(e,t,s=!0,r=!1){(r?document.querySelectorAll(`[data-result="${e}"]`):[document.querySelector(`[data-result="${e}"]`)]).forEach(o=>{o&&(o.innerText=s?"\u20AC"+t:t)})}getDifference(e,t){return Math.abs(e-t)}updateUI(e,t){this.calculatorDefault.classList.add("hide"),this.calculatorResult.style.display="block",window.scrollTo({top:this.resultWrapper.offsetTop,behavior:"smooth"}),d=document.querySelector('input[name="durationInMonths"]:checked').value;const s=y[d]||0;this.updateCalculationResults(e,t,s)}updateCalculationResults(e,t,s){console.log(e);const r=e.beforeLeaseSalary.employerCosts.holidayBonus+e.beforeLeaseSalary.employerCosts.sectoralPremium+e.beforeLeaseSalary.employerCosts.yearEndPremium,i=e.afterLeaseSalary.employerCosts.holidayBonus+e.afterLeaseSalary.employerCosts.sectoralPremium+e.afterLeaseSalary.employerCosts.yearEndPremium;let o,c,n;switch(document.querySelectorAll('[data-bonus="hide"]').forEach(a=>a.classList.add("hide",t.financingMethod==="BONUS")),document.querySelectorAll('[data-yearend="hide"]').forEach(a=>a.classList.add("hide",t.financingMethod==="YEAR_END_PREMIUM")),t.financingMethod){case"BONUS":o=e.leasePrice.monthlyLeasePrice*l*d,c=this.getDifference(e.beforeLeaseSalary.employerCosts.socialSecurityContributions,e.afterLeaseSalary.employerCosts.socialSecurityContributions)+this.getDifference(e.beforeLeaseSalary.employerCosts.socialSecurityStructuralReduction,e.afterLeaseSalary.employerCosts.socialSecurityStructuralReduction)+this.getDifference(e.beforeLeaseSalary.employerCosts.otherExpenses,e.afterLeaseSalary.employerCosts.otherExpenses),n=e.diffs.grossBonus,console.log(n),document.querySelectorAll('[data-bonus="show"').forEach(a=>a.classList.remove("hide")),document.querySelectorAll('[data-yearend="hide"],[data-yearend="show"],[data-after]').forEach(a=>a.classList.add("hide")),document.querySelectorAll(".calculator_output-item").forEach(a=>a.classList.add("is-bonus")),document.querySelectorAll("[data-bonus-alt]").forEach(a=>a.classList.add("is--alternate")),document.querySelectorAll("[data-bonus-regular]").forEach(a=>a.classList.remove("is--alternate"));break;case"YEAR_END_PREMIUM":o=e.leasePrice.monthlyLeasePrice*l*12,c=this.getDifference(e.beforeLeaseSalary.employerCosts.socialSecurityContributions,e.afterLeaseSalary.employerCosts.socialSecurityContributions)+this.getDifference(e.beforeLeaseSalary.employerCosts.socialSecurityStructuralReduction,e.afterLeaseSalary.employerCosts.socialSecurityStructuralReduction)+this.getDifference(e.beforeLeaseSalary.employerCosts.otherExpenses,e.afterLeaseSalary.employerCosts.otherExpenses),n=e.diffs.grossYearEndPremium,document.querySelectorAll('[data-yearend="show"]').forEach(a=>a.classList.remove("hide")),document.querySelectorAll('[data-bonus="hide"], [data-bonus="show"], [data-after]').forEach(a=>a.classList.add("hide")),document.querySelectorAll(".calculator_output-item").forEach(a=>a.classList.add("is-bonus")),document.querySelectorAll("[data-bonus-alt]").forEach(a=>a.classList.add("is--alternate")),document.querySelectorAll("[data-bonus-regular]").forEach(a=>a.classList.remove("is--alternate"));break;default:o=e.leasePrice.monthlyLeasePrice*l,c=o+e.diffs.grossSalary,n=e.diffs.grossSalary,document.querySelectorAll('[data-yearend="show"], [data-bonus="show"]').forEach(a=>a.classList.add("hide")),document.querySelectorAll('[data-yearend="hide"], [data-bonus="hide"], [data-after]').forEach(a=>a.classList.remove("hide")),document.querySelectorAll(".calculator_output-item").forEach(a=>a.classList.remove("is-bonus")),document.querySelectorAll("[data-bonus-alt]").forEach(a=>a.classList.remove("is--alternate")),document.querySelectorAll("[data-bonus-regular]").forEach(a=>a.classList.add("is--alternate"))}this.updateCalculatedValues(e,t,r,i,o,c,s,n)}updateCalculatedValues(e,t,s,r,i,o,c,n){document.querySelectorAll('[data-result="monthlyLeasePrice"]').forEach(L=>L.innerText=i.toFixed(1)),this.setValue("maintenanceCost",(e.leasePrice.maintenanceCost*12*l).toFixed(1)),this.setValue("servicePackage",document.querySelector('input[name="yearlyMaintenanceFee"]:checked').getAttribute("data-label"),!1),this.setValue("durationInMonths",document.querySelector('input[name="durationInMonths"]:checked').getAttribute("data-label").split(" ")[0],!1,!0),this.setValue("beforeSocialSecurityContribution",e.beforeLeaseSalary.employerCosts.socialSecurityContributions.toFixed(1)),this.setValue("afterSocialSecurityContribution",e.afterLeaseSalary.employerCosts.socialSecurityContributions.toFixed(1)),this.setValue("beforeSocialSecurityStructuralReduction",this.formatNegativeAmount(e.beforeLeaseSalary.employerCosts.socialSecurityStructuralReduction),!1),this.setValue("afterSocialSecurityStructuralReduction",this.formatNegativeAmount(e.afterLeaseSalary.employerCosts.socialSecurityStructuralReduction),!1),this.setValue("beforeOtherExpenses",e.beforeLeaseSalary.employerCosts.otherExpenses.toFixed(1)),this.setValue("afterOtherExpenses",e.afterLeaseSalary.employerCosts.otherExpenses.toFixed(1)),this.setValue("advantage",o.toFixed(1),!1,!0),this.setValue("recoup",Math.abs(n).toFixed(1),!1,!0),this.setValue("beforeEmployerTotal",this.formatNegativeAmount(s),!1),this.setValue("afterEmployerTotal",this.formatNegativeAmount(r),!1);const a=this.getDifference(e.beforeLeaseSalary.employerCosts.socialSecurityContributions,e.afterLeaseSalary.employerCosts.socialSecurityContributions)+this.getDifference(e.beforeLeaseSalary.employerCosts.socialSecurityStructuralReduction,e.afterLeaseSalary.employerCosts.socialSecurityStructuralReduction)+this.getDifference(e.beforeLeaseSalary.employerCosts.otherExpenses,e.afterLeaseSalary.employerCosts.otherExpenses)+this.getDifference(s,r);this.setValue("savedTotalYearly",a.toFixed(1)),this.setValue("beforeLeaseSalaryGross",e.beforeLeaseSalary.grossSalary.toFixed(1)),this.setValue("afterLeaseSalaryGross",e.afterLeaseSalary.grossSalary.toFixed(1)),this.setValue("beforeSocialSecurityContributions",this.formatNegativeAmount(e.beforeLeaseSalary.socialSecurityContributions),!1),this.setValue("beforeSpecialSocialSecurityContributions",this.formatNegativeAmount(e.beforeLeaseSalary.specialSocialSecurityContributions),!1),this.setValue("afterSocialSecurityContributions",this.formatNegativeAmount(e.afterLeaseSalary.socialSecurityContributions),!1),this.setValue("afterSpecialSocialSecurityContributions",this.formatNegativeAmount(e.afterLeaseSalary.specialSocialSecurityContributions),!1),this.setValue("beforeNetSalary",e.beforeLeaseSalary.monthlyNetSalary.toFixed(1)),this.setValue("afterNetSalary",e.afterLeaseSalary.monthlyNetSalary.toFixed(1)),this.setValue("beforeWorkBonus",e.beforeLeaseSalary.workBonus.toFixed(1)),this.setValue("afterWorkBonus",e.afterLeaseSalary.workBonus.toFixed(1)),this.setValue("beforeTaxableIncome",e.beforeLeaseSalary.taxableIncome.toFixed(1)),this.setValue("afterTaxableIncome",e.afterLeaseSalary.taxableIncome.toFixed(1)),this.setValue("beforeIncomeTax",this.formatNegativeAmount(e.beforeLeaseSalary.incomeTaxes),!1),this.setValue("afterIncomeTax",this.formatNegativeAmount(e.afterLeaseSalary.incomeTaxes),!1),this.setValue("monthlyNet",Math.abs(e.diffs.monthlyNet.toFixed(1))),this.setValue("totalNet",Math.abs(e.diffs.totalNet.toFixed(1))),this.setValue("residualValue",(t.computeLeaseRateDto.bikeRetailPrice*c*l).toFixed(1));const S=document.querySelector("#fietsVergoeding").value||.27,p=Math.min((4*(t.commuteKilometers*2)*t.commuteWeeklyFrequency*S).toFixed(1),625);this.setValue("potentialMonthlyBikeAllowance",p);const m=e.leasePrice.totalLeasePrice*l,b=Math.abs(m)-Math.abs(e.diffs.totalNet)-Math.abs(t.computeLeaseRateDto.bikeRetailPrice*t.computeLeaseRateDto.residualValue);this.setValue("packageValue",Math.abs(m.toFixed(1))),this.setValue("packageValueCalc",b.toFixed(1))}formatNegativeAmount(e){return e===0?"\u20AC0":`- \u20AC${Math.abs(e.toFixed(1))}`}async handleSubmit(e){e.preventDefault();try{this.setLoadingState(!0);const t=this.getFormData(),s=await this.fetchCalculation(t);this.updateUI(s,t)}catch(t){console.error("Submission error:",t),window.alert(`Error: ${t.message}`)}finally{this.setLoadingState(!1)}}}new f});
